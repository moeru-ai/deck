---
import { type Card, exportToJSON } from '@moeru-ai/ccc'
import { Markdown } from '@astropub/md'
import { Code, Tabs, TabItem } from '@astrojs/starlight/components'

interface Props {
  character: string
  json: Card
}

const { character, json } = Astro.props

const card = exportToJSON(json)
---

<Markdown.Inline of={`${json.notes ? `> ${json.notes}\n>\n` : ''}> <a href="data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(card))}" download="${character}.json">Download JSON</a>`} />

<hr />

<Tabs>
  {json.description && <TabItem label="Description"><Markdown of={json.description} /></TabItem>}
  {card.data.first_mes && <TabItem label="First Message"><Markdown of={card.data.first_mes} /></TabItem>}
  {card.data.alternate_greetings.length > 0 && <TabItem label="Alternate Greetings"><Markdown of={card.data.alternate_greetings.join('\n\n---\n\n')} /></TabItem>}
  {json.messageExample && <TabItem label="Example Messages"><Markdown of={card.data.mes_example.split('\n').join('\n\n')} /></TabItem>}
  {/* TODO: personality, character_book, system_prompt */}
</Tabs>

<hr />

<details>
  <summary>Raw JSON</summary>
  <Code code={JSON.stringify(card, null, 2)} lang="json" title={`length: ${JSON.stringify(card).length}`} />
</details>